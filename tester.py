from pymongo import MongoClient
import pymongo
import TOKENS

c = MongoClient(
    "mongodb://{usn}:{pwd}@nadir.space".format(
        usn=TOKENS.MONGO_USN, pwd=TOKENS.MONGO_PASS)
)
count = 0

for dup in c.discord.userinfo.aggregate([
    {"$group": {"_id": "user_id", "dups": {"$addToSet": "$_id"}, "count": {"$sum": 1}}},
    {"$match": {"count": {"$gt": 1}}}
], allowDiskUse=True):
    print(dup)
    duplicates = dup["dups"]
#
# from utils import utils_file
#
# # utils_file.pickle_file(duplicates, "dups")
# duplicates = utils_file.unpickle_file("dups")

print(duplicates)

# d = {"_id_" : {"ns": "overwatch.message_log", "v": 1, "key": [("_id", 1)]},
# "message_id_1": {"v": 1, "unique": True, "key": [("message_id", 1.0)], "ns": "overwatch.message_log"},
# "toxicity_1" : {"v": 1, "key": [("toxicity", 1.0)], "ns": "overwatch.message_log"},
# "server_id_1" : {"v": 1, "key": [("server_id", 1.0)], "ns": "overwatch.message_log"},
# "channel_id_1": {"v": 1, "key": [("channel_id", 1.0)], "ns": "overwatch.message_log"},
# "user_id_1" : {"v": 1, "key": [("user_id", 1.0)], "ns": "overwatch.message_log"}, "date_1": {"v": 1, "key": [("date", 1.0)], "ns": "overwatch.message_log"}}
#
# print("message_id_1"[:-2])
# def log_query_parser(query):
# try:
# query_state = {"users":[], "channels":[], "servers":[]}
# # query_list = query.split(" ")
# target = ""
# for word in query:
# if word in ["user","channel","server"]:
# word += "s"
# if word in query_state.keys():
# target = word
# continue
# query_state[target].append(word)
# return query_state
# except:
# return "Syntax not recognized. Proper syntax: user 1111 2222 channel 3333 4444 5555 server 66666"
#
# res = log_query_parser(["user", "11111", "2222", "channel", "4444", "servers", "66666"])
#
# filter = {}
# for key in res.keys():
# translate = {"users": "user_id", "channels": "channel_id", "servers": "server_id"}
# for key in res.keys():
# filter[translate[key]] = {"$in": res[key]}
# print(filter)

# text = "asdafdasfa \n asdasdasd \n asdasda".encode('utf-8')
# print(text)

# tok = "MjM2MzQxMTkzODQyMDk4MTc3.DEdB2Q.IoOntdD63XRGXABH_WClkupNu5c"
# import discord
#
# client = discord.Client()
#
#
# @client.event
# async def on_message(message_in):
# pass
#
# @client.event
# async def on_ready():
# print('Connected!')
# print('Username: ' + client.user.name)
# print('ID: ' + client.user.id)
#
#
#
# client.run(tok, bot=True)

# import pip
# print(pip.get_installed_dstributions())

a = {'user_id': '129706966460137472', 'nicks': ['z.nith', 'Zenith', 'Zenith#7998', 'zenith', 'austin', 'ok man person', 'yeoman janice section rand', 'bard',
                                                'nadir042', '[na] zenith042'], 'names': ['Zenith'],
     'server_joins': {'94882524378968064' : ['2016-06-27 05:51:15.380000'], '269539107615539201': ['2017-07-11 07:03:58.272799'],
                      '275771754125721611': ['2017-01-30 23:38:29.870000'], '103331749211156480': ['2017-01-23 01:09:10.820000'],
                      '117006615147708417': ['2017-01-04 00:31:01.594000'], '334568963935830037': ['2017-07-12 05:37:37.059000'],
                      '280833874299191296': ['2017-02-15 04:56:32.638000'], '294493172740915201': ['2017-05-04 16:53:24.019141'],
                      '214125103091417088': ['2017-01-04 00:31:15.593000'], '110373943822540800': ['2016-11-13 07:30:05.066000'],
                      '83411297193955328' : ['2017-01-04 00:31:37.114000'], '143661674505830400': ['2017-02-08 16:59:23.952000'],
                      '78581046714572800' : ['2017-01-04 00:30:53.106000'], '127283257120129035': ['2017-04-27 16:16:41.719135'],
                      '150097297185701889': ['2017-01-18 06:03:00.604000'], '214249708711837696': ['2017-07-11 06:56:06.890774'],
                      '181866934353133570': ['2017-01-30 02:50:46.768000'], '193446581704327169': ['2017-01-18 05:59:21.101000'],
                      '210912351380176897': ['2017-07-11 07:04:00.976584'], '175378978868166657': ['2017-01-04 00:30:43.830000'],
                      '215405614791262209': ['2017-01-18 05:59:59.853000'], '147445087075434499': ['2017-01-18 05:59:32.871000'],
                      '213881169844895744': ['2017-05-13 02:42:19.377775'], '212485713785126912': ['2017-01-25 02:32:46.082000'],
                      '266632338883084290': ['2017-04-28 07:20:31.909125'], '253308270498807808': ['2016-12-05 06:59:20.090000'],
                      '205162134739484672': ['2017-01-09 06:25:06.229000'], '217668246818652161': ['2017-01-09 06:26:40.966000'],
                      '270448599580672000': ['2017-01-18 08:55:39.200000'], '144822418396020736': ['2017-07-11 07:04:02.916509'],
                      '295897994652549122': ['2017-04-25 03:59:13.666698'], '272504822375383040': ['2017-01-21 23:16:52.576000'],
                      '210296628572192768': ['2016-09-24 01:19:19.055000'], '131530438131974144': ['2016-10-08 19:14:50.848000'],
                      '290572012437372931': ['2017-04-28 07:20:37.086805'], '295685443662643201': ['2017-03-27 15:53:33.637984'],
                      '236343416177295360': ['2016-10-14 04:24:21.468000'], '193277318494420992': ['2017-07-09 21:12:04.982131'],
                      '81384788765712384' : ['2016-10-25 03:30:58.456000'], '271759663807070209': ['2017-01-19 21:55:52.920000'],
                      '324793732325179392': ['2017-06-15 06:16:44.837041'], '120324250081951746': ['2015-12-24 22:09:10.662000'],
                      '281838462766940160': ['2017-02-26 20:48:30.327000'], '213550201477005312': ['2017-01-18 05:59:52.682000'],
                      '191298512388882434': ['2017-04-28 07:21:03.654234'], '209765433153159169': ['2017-01-09 06:26:25.478000'],
                      '125440014904590336': ['2017-04-18 17:39:54.122908'], '177183710007918593': ['2016-08-02 03:44:48.397000'],
                      '203003462114344960': ['2017-01-09 06:26:15.688000'], '181267459465019392': ['2016-05-15 04:52:10.131000'],
                      '209731933087858700': ['2017-01-09 06:26:17.894000'], '328246476973146122': ['2017-06-26 23:35:04.962648'],
                      '266279338305912832': ['2017-01-04 18:59:01.488000'], '199339772118827008': ['2016-12-31 01:54:09.979000'],
                      '274347674122190848': ['2017-01-27 01:19:42.647000'], '41771983423143937': ['2016-10-28 03:27:03.600000'],
                      '262668796521611264': ['2017-05-19 20:05:07.729919'], '208379761263771648': ['2016-10-24 20:21:50.709000'],
                      '147645543353548800': ['2017-04-28 07:20:41.634000'], '277664723238125568': ['2017-07-11 17:47:16.160266'],
                      '137463604311097345': ['2017-01-18 05:59:48.102000'], '272260955629420544': ['2017-01-21 07:07:50.190000'],
                      '192830142601494528': ['2016-11-19 04:28:25.838000'], '201820118588588033': ['2017-01-18 05:56:46.233000'],
                      '173236404745273345': ['2016-04-24 00:56:30.721000'], '227543998590353408': ['2017-01-04 00:30:32.824000'],
                      '210058276220436480': ['2017-01-09 06:26:20.742000'], '75630661951557632': ['2016-10-10 03:14:40.134000'],
                      '262761876373372938': ['2016-12-26 02:01:53.211000'], '229436216238538754': ['2017-05-09 23:52:02.321315'],
                      '86004744966914048' : ['2016-11-02 02:13:33.942000'], '215900891826487296': ['2017-01-04 00:30:37.488000'],
                      '201631526960627712': ['2017-01-04 00:24:32.891000'], '183244031281725440': ['2017-01-04 00:27:07.712000'],
                      '196511135946506240': ['2017-04-28 07:20:43.067000'], '197038439483310086': ['2016-10-28 03:29:24.011000'],
                      '206864173488013312': ['2017-01-09 06:26:07.514000'], '172018499005317120': ['2017-01-30 01:29:08.598000'],
                      '155821059960995840': ['2017-01-04 00:30:54.811000'], '334043962094387201': ['2017-07-10 18:51:26.834000'],
                      '286040194371682315': ['2017-02-28 07:41:36.773000'], '326757077714337802': ['2017-07-11 07:04:04.884706'],
                      '112539471353831424': ['2017-01-09 06:26:28.571000'], '209705424407101440': ['2017-01-09 06:26:13.215000'],
                      '161544001441366016': ['2016-08-31 03:46:34.441000'], '255913300544585728': ['2017-04-28 07:20:28.276000'],
                      '301392540723052544': ['2017-06-05 03:10:26.548000'], '224777231962996745': ['2017-01-15 23:18:08.735000'],
                      '293025597427548161': ['2017-04-18 05:46:21.966539'], '216218944397115394': ['2017-01-04 00:30:50.884000']},
     'created_at': '2015-12-24 22:09:10.643000', 'toxicity': 50.46333347543983, 'toxicity_count': 533}
